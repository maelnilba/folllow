import type {
  GetServerSidePropsContext,
  InferGetServerSidePropsType,
  NextPage,
} from "next";
import Head from "next/head";
import { getProviders, signIn } from "next-auth/react";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import {
  faTwitter,
  faGithub,
  faGoogle,
  faDiscord,
  IconDefinition,
} from "@fortawesome/free-brands-svg-icons";

const providerIcons: { [key: string]: IconDefinition } = {
  GitHub: faGithub,
  Google: faGoogle,
  Twitter: faTwitter,
  Discord: faDiscord,
};

const Index: NextPage<ServerSideProps> = ({ providers }) => {
  if (!providers) return <div>No provider found!</div>;
  return (
    <>
      <Head>
        <title>Create T3 App</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div className="flex flex-col min-h-screen justify-center items-center">
        <div className="">
          <div className="text-6xl font-bold">Folllow.</div>
        </div>
        <div className="grid grid-cols-2 gap-4 m-20 bg-base-200 p-10 border-solid border-inherit border-x-2 border-y-2 rounded-md">
          {Object.values(providers).map((provider) => (
            <div key={provider.name}>
              <button
                className="btn btn-outline gap-2 normal-case w-full"
                onClick={() =>
                  signIn(provider.id, {
                    callbackUrl: "http://localhost:3000/dashboard",
                  })
                }
              >
                <FontAwesomeIcon
                  icon={providerIcons[provider.name] || faDiscord}
                />
                Sign in with {provider.name}
              </button>
            </div>
          ))}
        </div>
      </div>
    </>
  );
};

type ServerSideProps = InferGetServerSidePropsType<typeof getServerSideProps>;
export async function getServerSideProps(context: GetServerSidePropsContext) {
  const providers = await getProviders();
  return {
    props: { providers },
  };
}

export default Index;
